<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Result</title>
  <!-- Bootstrap CSS for responsive layout --> 
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* Custom color scheme */
    body {
      font-family: 'Arial', sans-serif;
      background-color: #d9dbbe; /* Light background */
      color: #343a40; /* Dark text color */
    }
/*hi */
    .container {
      max-width: 600px;
      margin: 50px auto;
      padding: 30px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    h1 {
      font-size: 30px;
      color: #007bff;
      text-align: center;
      margin-bottom: 30px;
    }

    label, button {
      font-size: 16px;
    }

    input[type="text"] {
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-bottom: 20px;
      transition: all 0.3s;
    }

    input[type="text"]:focus {
      border-color: #28a745;
      outline: none;
    }

    button {
      padding: 12px 20px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #218838;
    }

    button:focus {
      outline: 2px solid #28a745;
    }

    #result-message {
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      margin-top: 10px;
    }

    #result-message.success {
      color: #28a745; /* Green for success */
    }

    #result-message.error {
      color: #dc3545; /* Red for error */
    }

    .spinner {
      border: 4px solid transparent;
      border-top: 4px solid #28a745;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .result-container {
      display: none;
      margin-top: 20px;
    }

    .result-container h3 {
      font-size: 20px;
      margin-bottom: 15px;
    }

    .result-container p {
      font-size: 16px;
      margin: 8px 0;
    }

    .result-container .details {
      font-weight: bold;
    }

    .result-container .qualified {
      color: #28a745;
    }

    /* Mobile responsiveness */
    @media (max-width: 470px) {
      .container {
      max-width: 95%; /* Further reduce width for extra-small devices */
      margin: 20px auto; /* Adjust margin for compact spacing */
      padding: 15px; /* Reduce padding for mobile devices */
    }

    h1 {
      font-size: 18px; /* Smaller font size for the title */
    }

    input[type="text"], button {
      font-size: 14px;
      width: 100%; /* Full width for mobile screens */
      padding: 10px;
    }

    input[type="text"] {
      margin-bottom: 10px; /* Reduce margin for input field */
    }

    button {
      padding: 10px 15px; /* Adjust padding for the button */
    }

    .spinner {
      width: 30px;
      height: 30px; /* Smaller spinner size */
      margin: 15px auto;
    }

    .result-container {
      text-align: left; /* Align text for better readability */
    }
  
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="text-center">
    <img src="smec.png" alt=""width="100px" height="100px"></div><br>
    <h1>ST. MARY'S ENGINEERING COLLEGE</h1>
    <h1 style="color: #ff0019;font-weight:bold;">CCC@SMEC Results</h1>
    
    <form id="result-form">
      <label for="hall-ticket">Enter Hall Ticket Number:</label>
      <input placeholder="Enter here" type="text" id="hall-ticket" name="hall-ticket"  required>
      <button type="submit">Check Result</button>
    </form>
    
    <div id="result">
      <div id="result-message"></div>
      <!-- Result container to show name, status, and marks -->
      <div class="result-container" id="result-details">
        <h3 style="font-weight: bold;">Result Details</h3>
        <p><span class="details">Name:</span> <span id="result-name"></span></p>
        <p><span class="details">Marks:</span> <span id="result-marks"></span></p>
        <p><span class="details">Result:</span> <span id="result-status" style="font-weight: bold;"></span></p>
        

        <!-- These fields will only be visible if the result is "Qualified" -->
        <div id="qualified-info" style="display: none;"><br>
          <h3 style="font-weight: bold; color: 007bff;">Next Level Details :-</h3>
          <p><span class="details">Room No:</span> <span id="result-room"></span></p>
          <p><span class="details">System No:</span> <span id="result-system"></span></p>
          <p><span class="details">Time:</span> <span id="result-time"></span></p>
          <br><h2 style="text-align: center;">ðŸŽ‰CongratulationsðŸŽ‰</h2>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('result-form').addEventListener('submit', async (event) => {
      event.preventDefault(); // Prevent the default form submission

      let hallTicket = document.getElementById('hall-ticket').value.trim();

  // Convert input to uppercase
          hallTicket = hallTicket.toUpperCase();

      // Validate the hall ticket input
      if (!hallTicket) {
        document.getElementById('result-message').textContent = "Please enter a valid hall ticket number.";
        return;
      }

      // Clear previous results and hide the result box
      const resultDetails = document.getElementById('result-details');
      resultDetails.style.display = 'none'; // Hide previous result
      document.getElementById('result-message').textContent = ''; // Clear any existing error message

      // Show spinner while fetching the result
      const spinner = document.createElement('div');
      spinner.classList.add('spinner');
      document.getElementById('result').appendChild(spinner);

      try {
        // Make a GET request to your Netlify function endpoint
        const response = await fetch(`/api/checkResult?ticketNumber=${hallTicket}`);

        // Hide spinner
        spinner.remove();

        if (response.ok) {
          const data = await response.json(); // Get the result, marks, name, room, system number, and time from the backend

          // Update and show result details
          const nameMessage = `${data.name}`;
          const resultMessage = `${data.result}`;
          const marksMessage = `${data.marks}`;
          const roomMessage = `${data.room_num}`;
          const systemMessage = `${data.system_num}`;
          const timeMessage = `${data.time}`;

          document.getElementById('result-name').textContent = nameMessage;
          document.getElementById('result-status').textContent = resultMessage;
          document.getElementById('result-marks').textContent = marksMessage;

          // Show result details box
          resultDetails.style.display = 'block';

          // Show additional details (Room No, System No, Time) only if result is "Qualified"
          const qualifiedInfo = document.getElementById('qualified-info');
          if (data.result === "Qualified") {
            qualifiedInfo.style.display = 'block';
            document.getElementById('result-room').textContent = roomMessage;
            document.getElementById('result-system').textContent = systemMessage;
            document.getElementById('result-time').textContent = timeMessage;
            resultDetails.classList.add('qualified');
          } else {
            qualifiedInfo.style.display = 'none'; // Hide qualified details if not qualified
            resultDetails.classList.remove('qualified');
          }

        } else {
          // Handle error response from the Netlify function
          const errorMessage = await response.json();
          document.getElementById('result-message').textContent = errorMessage.error || 'An error occurred.';
        }
      } catch (error) {
        // Handle fetch error
        spinner.remove();
        document.getElementById('result-message').textContent = "An error occurred while checking the result. Please try again.";
        console.error("Error fetching the result:", error);
      }
    });
  </script>
</body>
</html>
